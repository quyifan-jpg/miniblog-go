# æ–‡ç« æ‘˜è¦ç”ŸæˆåŸç†è¯¦è§£

## ğŸ“‹ æ¦‚è¿°

MiniBlog ä½¿ç”¨ **OpenAI GPT-4o** æ¨¡å‹æ¥åˆ†æå’Œæ€»ç»“æ–‡ç« ã€‚æ•´ä¸ªæµç¨‹åˆ†ä¸ºå‡ ä¸ªå…³é”®æ­¥éª¤ï¼Œä»åŸå§‹ HTML å†…å®¹åˆ°ç»“æ„åŒ–çš„æ‘˜è¦å’Œåˆ†ç±»ã€‚

## ğŸ”„ å®Œæ•´å¤„ç†æµç¨‹

### 1. æ–‡ç« æ”¶é›†é˜¶æ®µ
```
RSS Feed / URL â†’ çˆ¬å–åŸå§‹ HTML â†’ å­˜å‚¨åˆ°æ•°æ®åº“
```

### 2. AI åˆ†æé˜¶æ®µï¼ˆæ ¸å¿ƒï¼‰
```
æœªå¤„ç†æ–‡ç«  â†’ HTML æ¸…ç† â†’ GPT-4o åˆ†æ â†’ ç»“æ„åŒ–è¾“å‡º
```

## ğŸ§  æ ¸å¿ƒä»£ç è§£æ

### æ–‡ä»¶ä½ç½®
ä¸»è¦ä»£ç åœ¨ï¼š`processors/ai_analysis_processor.py`

### å…³é”®å‡½æ•°è¯¦è§£

#### 1. `extract_clean_text()` - HTML æ¸…ç†
```python
def extract_clean_text(raw_html, max_tokens=8000):
    """
    ä»åŸå§‹ HTML ä¸­æå–å¹²å‡€çš„æ–‡æœ¬å†…å®¹
    
    æ­¥éª¤ï¼š
    1. ä½¿ç”¨ BeautifulSoup è§£æ HTML
    2. ç§»é™¤è„šæœ¬ã€æ ·å¼ã€å¯¼èˆªç­‰æ— å…³å…ƒç´ 
    3. æå–çº¯æ–‡æœ¬å¹¶æ¸…ç†ç©ºç™½
    4. é™åˆ¶æœ€å¤§ token æ•°ï¼ˆé»˜è®¤ 8000ï¼Œçº¦ 32000 å­—ç¬¦ï¼‰
    """
```

**ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸€æ­¥ï¼Ÿ**
- åŸå§‹ HTML åŒ…å«å¤§é‡æ— å…³å†…å®¹ï¼ˆå¯¼èˆªæ ã€å¹¿å‘Šã€è„šæœ¬ç­‰ï¼‰
- å‡å°‘å‘é€ç»™ AI çš„ token æ•°é‡ï¼ŒèŠ‚çœæˆæœ¬
- æé«˜ AI åˆ†æçš„è´¨é‡å’Œé€Ÿåº¦

#### 2. `process_article_with_ai()` - AI åˆ†ææ ¸å¿ƒ

è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒå‡½æ•°ï¼Œè®©æˆ‘ä»¬è¯¦ç»†çœ‹çœ‹ï¼š

```python
def process_article_with_ai(client, article, max_tokens=8000):
    # æ­¥éª¤ 1: æ¸…ç† HTML
    clean_text = extract_clean_text(article["raw_content"], max_tokens)
    
    # æ­¥éª¤ 2: æå–å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€URLã€æè¿°ï¼‰
    title = article["title"]
    url = article["url"]
    description = metadata.get("description", "")
    
    # æ­¥éª¤ 3: æ„å»º AI æç¤ºè¯
    prompt = f"""
    Analyze this article and provide a structured output with three components:
    
    1. A list of 3-5 relevant categories for this article
    2. A concise 2-3 sentence summary of the article
    3. The extracted main article content, removing any navigation, ads, or irrelevant elements
    
    Article Title: {title}
    Article URL: {url}
    Description: {description}
    
    Article Text:
    {clean_text}
    
    Provide your response as a JSON object with these keys:
    - categories: an array of 3-5 relevant categories (as strings)
    - summary: a 2-3 sentence summary of the article
    - content: the cleaned main article content
    """
    
    # æ­¥éª¤ 4: è°ƒç”¨ OpenAI API
    response = client.chat.completions.create(
        model="gpt-4o",                    # ä½¿ç”¨ GPT-4o æ¨¡å‹
        response_format={"type": "json_object"},  # å¼ºåˆ¶ JSON è¾“å‡º
        messages=[
            {
                "role": "system",
                "content": "You are a helpful assistant that analyzes articles and extracts structured information."
            },
            {
                "role": "user",
                "content": prompt
            }
        ],
        temperature=0.3,      # ä½æ¸©åº¦ = æ›´ç¡®å®šæ€§çš„è¾“å‡º
        max_tokens=1500,     # é™åˆ¶è¾“å‡ºé•¿åº¦
    )
    
    # æ­¥éª¤ 5: è§£æ JSON å“åº”
    response_json = json.loads(response.choices[0].message.content)
    
    return {
        "categories": response_json.get("categories", []),
        "summary": response_json.get("summary", ""),
        "content": response_json.get("content", ""),
    }
```

### 3. å…³é”®è®¾è®¡å†³ç­–

#### ä¸ºä»€ä¹ˆä½¿ç”¨ GPT-4oï¼Ÿ
- **é«˜è´¨é‡ç†è§£**ï¼šGPT-4o å¯¹é•¿æ–‡æœ¬çš„ç†è§£èƒ½åŠ›æ›´å¼º
- **ç»“æ„åŒ–è¾“å‡º**ï¼šé€šè¿‡ `response_format={"type": "json_object"}` ç¡®ä¿è¿”å› JSON
- **å‡†ç¡®æ€§**ï¼šåœ¨åˆ†ç±»å’Œæ‘˜è¦ä»»åŠ¡ä¸Šè¡¨ç°ä¼˜ç§€

#### ä¸ºä»€ä¹ˆè®¾ç½® `temperature=0.3`ï¼Ÿ
- **ä½æ¸©åº¦ = æ›´ç¡®å®šæ€§**ï¼šæ‘˜è¦éœ€è¦å‡†ç¡®ã€ä¸€è‡´ï¼Œä¸éœ€è¦åˆ›é€ æ€§
- **å¯é‡å¤æ€§**ï¼šç›¸åŒæ–‡ç« ä¼šäº§ç”Ÿç›¸ä¼¼çš„æ‘˜è¦

#### ä¸ºä»€ä¹ˆé™åˆ¶ `max_tokens=1500`ï¼Ÿ
- **æˆæœ¬æ§åˆ¶**ï¼šé™åˆ¶è¾“å‡ºé•¿åº¦ï¼ŒèŠ‚çœ API è°ƒç”¨æˆæœ¬
- **è´¨é‡ä¿è¯**ï¼šå¼ºåˆ¶ AI ç”Ÿæˆç®€æ´çš„æ‘˜è¦

## ğŸ“Š æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸå§‹ HTML æ–‡ç«   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ extract_clean_text() â”‚  â† æ¸…ç† HTMLï¼Œæå–æ–‡æœ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ„å»º Prompt    â”‚  â† åŒ…å«ï¼šæ ‡é¢˜ã€URLã€æè¿°ã€æ–‡æœ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenAI GPT-4o  â”‚  â† AI åˆ†æ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JSON å“åº”è§£æ   â”‚  â† æå–ï¼šcategories, summary, content
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å­˜å‚¨åˆ°æ•°æ®åº“    â”‚  â† ä¿å­˜åˆ†æç»“æœ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Prompt å·¥ç¨‹æŠ€å·§

### ç³»ç»Ÿæç¤ºè¯ï¼ˆSystem Promptï¼‰
```
"You are a helpful assistant that analyzes articles and extracts structured information."
```
- **ç®€æ´æ˜ç¡®**ï¼šå‘Šè¯‰ AI å®ƒçš„è§’è‰²
- **ä»»åŠ¡å¯¼å‘**ï¼šä¸“æ³¨äºä¿¡æ¯æå–

### ç”¨æˆ·æç¤ºè¯ï¼ˆUser Promptï¼‰
åŒ…å«ä¸‰ä¸ªå…³é”®éƒ¨åˆ†ï¼š

1. **ä»»åŠ¡æè¿°**ï¼šæ˜ç¡®è¦æ±‚ä¸‰ä¸ªè¾“å‡º
2. **ä¸Šä¸‹æ–‡ä¿¡æ¯**ï¼šæä¾›æ ‡é¢˜ã€URLã€æè¿°
3. **è¾“å‡ºæ ¼å¼**ï¼šæŒ‡å®š JSON ç»“æ„

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ
- **ç»“æ„åŒ–è¾“å‡º**ï¼šJSON æ ¼å¼ä¾¿äºç¨‹åºå¤„ç†
- **å¤šä»»åŠ¡å¤„ç†**ï¼šä¸€æ¬¡è°ƒç”¨å®Œæˆåˆ†ç±»ã€æ‘˜è¦ã€å†…å®¹æå–
- **ä¸Šä¸‹æ–‡ä¸°å¯Œ**ï¼šæä¾›å…ƒæ•°æ®å¸®åŠ© AI ç†è§£æ–‡ç« 

## ğŸ”§ æ‰¹å¤„ç†æœºåˆ¶

### `analyze_articles()` å‡½æ•°
```python
def analyze_articles(batch_size=5, delay_range=(1, 3)):
    """
    æ‰¹é‡å¤„ç†æ–‡ç« 
    
    ç‰¹ç‚¹ï¼š
    - æ¯æ¬¡å¤„ç† 5 ç¯‡æ–‡ç« ï¼ˆé»˜è®¤ï¼‰
    - æ–‡ç« ä¹‹é—´éšæœºå»¶è¿Ÿ 1-3 ç§’ï¼ˆé¿å… API é™æµï¼‰
    - è·Ÿè¸ªæˆåŠŸ/å¤±è´¥ç»Ÿè®¡
    - æ”¯æŒé‡è¯•æœºåˆ¶ï¼ˆé€šè¿‡ ai_attempts å­—æ®µï¼‰
    """
```

### ä¸ºä»€ä¹ˆéœ€è¦å»¶è¿Ÿï¼Ÿ
- **API é™æµ**ï¼šé¿å…è§¦å‘ OpenAI çš„é€Ÿç‡é™åˆ¶
- **æˆæœ¬æ§åˆ¶**ï¼šæ§åˆ¶ API è°ƒç”¨é¢‘ç‡
- **ç¨³å®šæ€§**ï¼šå‡å°‘å› ç½‘ç»œé—®é¢˜å¯¼è‡´çš„å¤±è´¥

## ğŸ’¾ æ•°æ®å­˜å‚¨

### æ•°æ®åº“è¡¨ç»“æ„
åˆ†æç»“æœå­˜å‚¨åœ¨ `crawled_articles` è¡¨ä¸­ï¼š

- `categories`: JSON æ•°ç»„ï¼Œå­˜å‚¨åˆ†ç±»æ ‡ç­¾
- `summary`: æ–‡æœ¬ï¼Œå­˜å‚¨ 2-3 å¥æ‘˜è¦
- `content`: æ–‡æœ¬ï¼Œå­˜å‚¨æ¸…ç†åçš„æ–‡ç« å†…å®¹
- `ai_status`: çŠ¶æ€ï¼ˆpending/processing/success/errorï¼‰
- `ai_attempts`: é‡è¯•æ¬¡æ•°

### çŠ¶æ€ç®¡ç†
```python
# æœªå¤„ç† â†’ å¤„ç†ä¸­ â†’ æˆåŠŸ/å¤±è´¥
pending â†’ processing â†’ success/error
```

## ğŸš€ å¦‚ä½•è¿è¡Œ

### æ‰‹åŠ¨è¿è¡Œ
```bash
cd miniblog
python -m processors.ai_analysis_processor --batch_size 10
```

### è‡ªåŠ¨è°ƒåº¦
åœ¨ Voyager æ ‡ç­¾é¡µåˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œè‡ªåŠ¨è¿è¡Œ AI åˆ†æå¤„ç†å™¨ã€‚

## ğŸ“ å­¦ä¹ è¦ç‚¹æ€»ç»“

1. **HTML æ¸…ç†å¾ˆé‡è¦**ï¼šå‡å°‘å™ªéŸ³ï¼Œæé«˜ AI åˆ†æè´¨é‡
2. **Prompt è®¾è®¡**ï¼šæ˜ç¡®çš„ä»»åŠ¡æè¿° + ç»“æ„åŒ–è¾“å‡ºè¦æ±‚
3. **æ¨¡å‹é€‰æ‹©**ï¼šGPT-4o é€‚åˆéœ€è¦é«˜è´¨é‡ç†è§£çš„åœºæ™¯
4. **å‚æ•°è°ƒä¼˜**ï¼štemperature=0.3 ä¿è¯ä¸€è‡´æ€§ï¼Œmax_tokens æ§åˆ¶æˆæœ¬
5. **æ‰¹å¤„ç†ç­–ç•¥**ï¼šå»¶è¿Ÿ + é‡è¯•æœºåˆ¶ä¿è¯ç¨³å®šæ€§
6. **ç»“æ„åŒ–è¾“å‡º**ï¼šJSON æ ¼å¼ä¾¿äºåç»­å¤„ç†

## ğŸ” è¿›ä¸€æ­¥æ¢ç´¢

- æŸ¥çœ‹ `db/articles.py` äº†è§£æ•°æ®åº“æ“ä½œ
- æŸ¥çœ‹ `processors/embedding_processor.py` äº†è§£å‘é‡åŒ–å¤„ç†
- æŸ¥çœ‹ `services/article_service.py` äº†è§£ API æ¥å£

## ğŸ’¡ æ”¹è¿›å»ºè®®

å¦‚æœä½ æƒ³æ”¹è¿›æ‘˜è¦è´¨é‡ï¼Œå¯ä»¥ï¼š

1. **è°ƒæ•´ Prompt**ï¼šæ›´è¯¦ç»†çš„æŒ‡ä»¤ï¼ŒæŒ‡å®šæ‘˜è¦é£æ ¼
2. **è°ƒæ•´å‚æ•°**ï¼šå¢åŠ  max_tokens è·å¾—æ›´è¯¦ç»†æ‘˜è¦
3. **å¤šè½®åˆ†æ**ï¼šå…ˆåˆ†ç±»ï¼Œå†é’ˆå¯¹ä¸åŒç±»åˆ«ä½¿ç”¨ä¸åŒç­–ç•¥
4. **åå¤„ç†**ï¼šå¯¹ AI è¾“å‡ºè¿›è¡ŒéªŒè¯å’Œæ¸…ç†


